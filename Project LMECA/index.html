<!doctype html>
<html lang="en">

	<head>
		<title>Project</title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="./style.css" type="text/css">
        <script type="text/javascript" src="mesh_small.json"></script>
		<script type="text/javascript" src="nodes_coarse.json"></script>
		<script type="text/javascript" src="app.js"></script>
        <script src="https://unpkg.com/robust-predicates@3.0.1/umd/predicates.min.js"></script>
	</head>

	<body>
        <canvas id="canvas1" width="900" height="900", style="border:2px solid steelblue;"></canvas>
		<canvas id="canvas2" width="900" height="900", style="border:2px solid steelblue; display: none;"></canvas>
		
		<div id="info">
			<h1>Numerical Geometry: Project</h1>
			<p style="margin-bottom: 50px;">Authors: Gabriel de Morais Pires and Gabriela Ishikawa</p>
			
			<div id="firstPart">
			  <h2>Point Location in Triangle</h2>
			  <p>
				This implementation shows the mesh provided by the JSON file and locate the triangle that contains the  
				point clicked on in the canvas by filling it and identifing the face.id. 
			  </p>
			  <p>If you want to clear the canvas, click in "Clear Canvas" button:</p>
			  <div style="display:flex; flex-direction: column;">
				  <button id="clear1Button">Clear Canvas</button>
			  </div>  

			  <p style="margin-top: 20px;">To change to the <b><i>Segment Intersection with Triangulation</i></b> implementation, just click in "Change Implementation" button:</p>
			</div>
  
			<div id="secondPart" style="display: none;">
			  <h2>Segment Intersection with Triangulation</h2>
			  <p>
				This implementation shows the mesh provided by the JSON file and locate the triangle that contains the  
				point clicked on in the canvas by filling it and identifWing the face.id. 
			  </p>
			  <p>If you want to clear the canvas, click in "Clear Canvas" button:</p>
			  <div style="display:flex; flex-direction: column;">
				  <button id="clear2Button">Clear Canvas</button>
			  </div>

			  <p style="margin-top: 20px;">To change to the <b><i>Point Location in Triangle</i></b> implementation, just click in "Change Implementation" button:</p>
			</div>
		
			<button id="switchButton" style="margin-top: 5px;">Change Implementation</button>
  
		  </div>
		
		<script>
            const canvas1 = document.getElementById("canvas1");
			const canvas2 = document.getElementById("canvas2");
			mesh = create_mesh2(nodeData);
			
			// find the convexHull given an array of points
			convexVertex = findConvex(mesh);
			create_random_triangles(mesh, convexVertex);
			
			
            const clear1Button = document.getElementById("clear1Button");
            const clear2Button = document.getElementById("clear2Button");
            const switchButton = document.getElementById("switchButton");

            // ALTERNATE IMPLEMENTATIONS ON BUTTON CLICK
            switchButton.addEventListener("click", function () {
                if (canvas1.style.display === "none") {
                    canvas1.style.display = "block";
                    canvas2.style.display = "none";
                    firstPart.style.display = "block";
                    secondPart.style.display = "none";
                } else {
                    canvas1.style.display = "none";
                    canvas2.style.display = "block";
                    firstPart.style.display = "none";
                    secondPart.style.display = "block";
                }
            });

			// ZOOM AND CLICK AND DRAG
			const ctx = canvas1.getContext("2d");

			// Variables for zooming
			let scale = 1;
			let offsetX = 0;
			let offsetY = 0;
			let isDragging = false;
			let startDragX, startDragY;

			function draw() {
				// Clear the entire canvas
				ctx.clearRect(-10000, -10000, (canvas1.width)*1000, (canvas1.height)*1000);

				// Draw your content here
				ctx.setTransform(scale, 0, 0, scale, offsetX, offsetY);
				draw_mesh2(mesh, canvas1);		
			}

			

			function zoomIn() {
				scale += 0.1;
				draw();
			}

			function zoomOut() {
				if (scale > 0.5) {
					scale -= 0.1;
					draw();
				}
			}

			function handleScroll(event) {
				if (event.deltaY < 0) {
					zoomIn();
				} else {
					zoomOut();
				}
			}

			function handleMouseDown(event) {
				isDragging = true;
				startDragX = event.clientX - offsetX;
				startDragY = event.clientY - offsetY;
			}

			function handleMouseMove(event) {
				if (isDragging) {
					offsetX = event.clientX - startDragX;
					offsetY = event.clientY - startDragY;
					draw();
				}
			}

			function handleMouseUp() {
				isDragging = false;
			}

			function handleMouseLeave() {
				isDragging = false;
			}

			// Event listeners
			canvas1.addEventListener("wheel", handleScroll);
			canvas1.addEventListener("mousedown", handleMouseDown);
			canvas1.addEventListener("mousemove", handleMouseMove);
			canvas1.addEventListener("mouseup", handleMouseUp);
			canvas1.addEventListener("mouseleave", handleMouseLeave);

			// Initial draw
			draw();
			

			

        </script>
	</body>

</html>